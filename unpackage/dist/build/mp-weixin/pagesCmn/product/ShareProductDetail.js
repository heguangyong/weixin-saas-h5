(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesCmn/product/ShareProductDetail"],{"3ede":function(e,t,n){"use strict";var r=n("da83"),o=n.n(r);o.a},"43ec":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=u(n("a34a")),o=n("2f62"),a=u(n("2f7e")),c=u(n("4249"));function u(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n,r,o,a,c){try{var u=e[a](c),i=u.value}catch(d){return void n(d)}u.done?t(i):Promise.resolve(i).then(r,o)}function d(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function c(e){i(a,r,o,c,u,"next",e)}function u(e){i(a,r,o,c,u,"throw",e)}c(void 0)}))}}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){p(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f={data:function(){return{isLoad:!1,product:{_id:"",qrcode:"",detail:{content:"",images:[],imgList:[],videos:[]},num:1},priceAndUnitName:"",authBizInfo:{}}},onLoad:function(e){var t=this;if(e.id)t.product._id=e.id,t.getDetail();else if(e.scene){t.paramsStr+="scene="+e.scene;var n={},r=decodeURIComponent(e.scene).split("&");r.forEach((function(e){var r=e.split("=");n[r[0]]=r[1],"qrcode"==r[0]&&(t.product.qrcode=r[1])})),t.getDetailByQrcode()}t.authBizInfo={_id:t.product.card_id,name:t.product.name,avatar:t.product.avatar},t.needWxAuth(t.authBizInfo)},onReady:function(){wx.setNavigationBarTitle({title:"产品详情"})},onShareAppMessage:function(t){if("button"===t.from){var n=t.target.dataset.product;return{title:n.title,desc:n.detail.content,imageUrl:n.cover||"",path:"/pagesCmn/product/ShareProductDetail?id="+n._id,success:function(t){e.showToast({icon:"success",title:"分享成功"})}}}},computed:l({},(0,o.mapState)(["user","filePath"])),methods:l(l({},(0,o.mapMutations)(["needWxAuth","convertFilePath"])),{},{ShareProductDetail:function(){e.showShareMenu({withShareTicket:!0})},getDetail:function(){var t=this;return d(r.default.mark((function n(){var o,u,i,d,s;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o=t,n.next=3,a.default.auth().anonymousAuthProvider().signIn();case 3:return n.next=5,a.default.auth().getLoginState();case 5:return u=n.sent,console.log("login",u.isAnonymousAuth),n.next=9,a.default.callFunction({name:"web",data:{$url:"getProductDetail",id:o.product._id}});case 9:return i=n.sent,o.product=JSON.parse(i.result.data),0==o.product.cover.indexOf("cloud")&&(o.convertFilePath(o.product.cover),o.product.cover=o.filePath,o.convertFilePath(o.product.detail.videos[0]),o.product.detail.videos[0]=o.filePath),d="http://cb.upservce.com/#/pagesCmn/product/ShareProductDetail?id="+o.product._id,n.next=15,a.default.callFunction({name:"web",data:{$url:"signWeixin",url:d,needRefreshSignature:!1}});case 15:i=n.sent,s=JSON.parse(i.result.data),console.log("sign",i.result.data),c.default.config({debug:s.debug,appId:s.appId,nonceStr:s.nonceStr,timestamp:s.timestamp,signature:s.signature,jsApiList:s.jsApiList}),c.default.ready((function(){c.default.onMenuShareAppMessage({title:o.product.title,desc:o.product.detail.content,link:d,imgUrl:o.product.cover,success:function(){console.log("success")}}),c.default.onMenuShareTimeline({title:o.product.title,desc:o.product.detail.content,link:d,imgUrl:o.product.cover,success:function(){console.log("success")}}),c.default.updateAppMessageShareData({title:o.product.title,desc:o.product.detail.content,link:d,imgUrl:o.product.cover,success:function(){console.log("success")}})})),c.default.error((function(t){console.log("jweixin.error",t),a.default.callFunction({name:"web",data:{$url:"signWeixin",url:d,needRefreshSignature:!0}}),setTimeout((function(){e.showToast({icon:"none",title:"产品授权变更，需刷新后重新分享！"})}),500)})),o.product.num=1,o.priceAndUnitName="¥ "+parseFloat(o.product.price).toFixed(2)+o.product.unit_name,o.authBizInfo={_id:o.product.card_id,name:o.product.name,avatar:o.product.avatar},o.needWxAuth(o.authBizInfo);case 25:case"end":return n.stop()}}),n)})))()},getDetailByQrcode:function(){var e=this;return d(r.default.mark((function t(){var n,o;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e,o={},t.next=4,wx.cloud.callFunction({name:"cmn",data:{$url:"getProductDetailByQrcode",qrcode:n.product.qrcode}});case 4:o=t.sent,n.product=o.result.data,n.product.num=1,n.priceAndUnitName="¥ "+parseFloat(n.product.price).toFixed(2)+n.product.unit_name,n.authBizInfo={_id:n.product.card_id,name:n.product.name,avatar:n.product.avatar},n.needWxAuth(n.authBizInfo);case 10:case"end":return t.stop()}}),t)})))()},previewImage:function(e){var t=this;console.log(e);var n="",r=[];for(var o in n=e.currentTarget.dataset.src,t.product.carouse)r.push(t.product.carouse[o]);for(var a=0;a<t.product.detail.images.length;a++)r.push(t.product.detail.images[a]);wx.previewImage({current:n,urls:r})},goQrcode:function(t){console.log("goQrcode",t),e.navigateTo({url:"/pagesCmn/product/ProductQrcode?id="+t})}})};t.default=f}).call(this,n("543d")["default"])},"558d":function(e,t,n){"use strict";var r;n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return r}));var o=function(){var e=this,t=e.$createElement;e._self._c},a=[]},"61fe":function(e,t,n){"use strict";n.r(t);var r=n("43ec"),o=n.n(r);for(var a in r)"default"!==a&&function(e){n.d(t,e,(function(){return r[e]}))}(a);t["default"]=o.a},c907:function(e,t,n){"use strict";(function(e){n("6776");r(n("66fd"));var t=r(n("e9a1"));function r(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},da83:function(e,t,n){},e9a1:function(e,t,n){"use strict";n.r(t);var r=n("558d"),o=n("61fe");for(var a in o)"default"!==a&&function(e){n.d(t,e,(function(){return o[e]}))}(a);n("3ede");var c,u=n("f0c5"),i=Object(u["a"])(o["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],c);t["default"]=i.exports}},[["c907","common/runtime","common/vendor"]]]);